#!/usr/bin/env python3

import swpag_client
import optparse
import time
import subprocess
import sys

def get_argument():
    parser = optparse.OptionParser()
    parser.add_option("-e", "--real_capture_flag_script", dest="ctf_script", help = 'real_capture_flag_script')

    (options, arguments) = parser.parse_args()
    if not options.ctf_script:
        parser.error("[-] Please specify which capture_flag_script to run, use --help for more info.")
    return options

if __name__ == "__main__":
    options = get_argument()
    t = swpag_client.Team('http://52.52.83.248', 'pc9Zhk3DDDV9Y5ILrUs2')
    try:
        while(1):
            print('Approximate seconds left for next tick: %s\n' % str(t.get_tick_info()['approximate_seconds_left']))
            if (t.get_tick_info()['approximate_seconds_left'] < 10):
                time.sleep(10)

                # Execute real exploit script
                print("I am coming!\n")
                for i in range (5):
                    result = subprocess.run('./%s' % options.ctf_script)
                    time.sleep(1)
    except KeyboardInterrupt:
        # print("Test interrupt")
        exit(0)
    